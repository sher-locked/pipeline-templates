#
# The output generated by this tool should be used as a base for further
# modifications. It does not make assumptions as to what things can be made into
# variables, modules, partials or Jinja templates. This is your responsibility as
# the owner of the template.
#
# Some recommendations to massage the initial output:
#
# * Rename the pipeline stage IDs, notification names and trigger names to be
#   more meaningful. Enumerated stage IDs is ultimately a detriment for
#   long-term maintainability.
# * The template is currently ordered, so keys may not necessarily be structured
#   in the most sensible format. You may want to massage the template a little.

INFO[0000] configuration:
  concurrentExecutions:
    limitConcurrent: true
    parallel: false
  expectedArtifacts:
  - defaultArtifact:
      kind: default.bitbucket
      name: deploys/deployment-canary.yml
      reference: https://api.bitbucket.org/1.0/repositories/sher-locked/simple-deploy/raw/master/deploys/deployment-canary.yml
      type: bitbucket/file
    id: 33022621-2435-46d0-baa8-799a76311d7a
    matchArtifact:
      kind: bitbucket
      name: deploys/deployment-canary.yml
      type: bitbucket/file
    useDefaultArtifact: true
    usePriorExecution: false
  - defaultArtifact:
      kind: default.bitbucket
      name: deploys/deployment-prod.yml
      reference: https://api.bitbucket.org/1.0/repositories/sher-locked/simple-deploy/raw/master/deploys/deployment-prod.yml
      type: bitbucket/file
    id: 38eefab0-78e4-4c9e-b779-4957de38e47b
    matchArtifact:
      kind: bitbucket
      name: deploys/deployment-prod.yml
      type: bitbucket/file
    useDefaultArtifact: true
    usePriorExecution: false
  - defaultArtifact:
      kind: default.bitbucket
      name: deploys/deployment-baseline.yml
      reference: https://api.bitbucket.org/1.0/repositories/sher-locked/simple-deploy/raw/master/deploys/deployment-baseline.yml
      type: bitbucket/file
    id: 2fa9c846-887d-482b-8050-cc519cdd5bc2
    matchArtifact:
      kind: bitbucket
      name: deploys/deployment-baseline.yml
      type: bitbucket/file
    useDefaultArtifact: true
    usePriorArtifact: false
    usePriorExecution: false
  triggers:
  - branch: master
    enabled: false
    name: unnamed0
    project: sher-locked
    slug: simple-deploy
    source: bitbucket
    type: git
id: v2deploy-44AutomatedVerification
metadata:
  description: This template does not have a description
  name: 4.4-Automated-Verification
  owner: opsmxemp1
  scopes:
  - v2deploy
protect: false
schema: "1"
stages:
- config:
    account: my-k8s-v2-account
    cloudProvider: kubernetes
    manifestArtifactAccount: my-bitbucket-account
    manifestArtifactId: 2fa9c846-887d-482b-8050-cc519cdd5bc2
    manifests: []
    moniker:
      app: v2deploys
    relationships:
      loadBalancers: []
      securityGroups: []
    requiredArtifactIds: []
    source: artifact
  dependsOn:
  - jenkins20
  id: deployManifest7
  inheritanceControl: {}
  inject: {}
  name: Baseline Deploy
  type: deployManifest
- config:
    account: my-k8s-v2-account
    cloudProvider: kubernetes
    manifestArtifactAccount: my-bitbucket-account
    manifestArtifactId: 33022621-2435-46d0-baa8-799a76311d7a
    moniker:
      app: v2deploys
    relationships:
      loadBalancers: []
      securityGroups: []
    requiredArtifactIds: []
    source: artifact
  dependsOn:
  - jenkins20
  id: deployManifest8
  inheritanceControl: {}
  inject: {}
  name: Canary Deploy
  type: deployManifest
- config:
    baseline: {}
    canary:
      application: v2deploys
      canaryConfig:
        canaryAnalysisConfig:
          beginCanaryAnalysisAfterMins: "5"
          canaryAnalysisIntervalMins: "15"
          lookbackMins: 0
          name: metric-template:optemp;log-template:devlogtemp
          notificationHours: []
          useLookback: false
        canaryHealthCheckHandler:
          '@class': com.netflix.spinnaker.mine.CanaryResultHealthCheckHandler
          minimumCanaryResultScore: "60"
        canarySuccessCriteria:
          canaryResultScore: "70"
        combinedCanaryResultStrategy: AGGREGATE
        lifetimeHours: "0.6"
        name: anush
      canaryDeployments:
      - '@class': .CanaryTaskDeployment
        accountName: my-k8s-v2-account
        baseline: ${#stage("Baseline Deploy")["outputs"]["outputs.createdArtifacts"][0]["reference"]}
        canary: ${#stage("Canary Deploy")["outputs"]["outputs.createdArtifacts"][0]["reference"]}
        type: cluster
      owner: anush@opsmx.com
      watchers: []
    completeOtherBranchesThenFail: false
    continuePipeline: true
    failPipeline: false
  dependsOn:
  - deployManifest7
  - deployManifest8
  id: acaTask10
  inheritanceControl: {}
  inject: {}
  name: Automated Canary
  type: acaTask
- config:
    account: my-k8s-v2-account
    cloudProvider: kubernetes
    kinds: []
    location: production
    manifestName: replicaSet ${#stage("Baseline Deploy")["outputs"]["outputs.createdArtifacts"][0]["reference"]}
    options:
      cascading: true
    stageEnabled:
      expression: ""
      type: expression
  dependsOn:
  - acaTask10
  id: deleteManifest12
  inheritanceControl: {}
  inject: {}
  name: Delete Baseline
  type: deleteManifest
- config:
    account: my-k8s-v2-account
    cloudProvider: kubernetes
    kinds: []
    location: production
    manifestName: replicaSet ${#stage("Canary Deploy")["outputs"]["outputs.createdArtifacts"][0]["reference"]}
    options:
      cascading: true
  dependsOn:
  - acaTask10
  id: deleteManifest13
  inheritanceControl: {}
  inject: {}
  name: Delete Canary
  type: deleteManifest
- config:
    account: my-k8s-v2-account
    cloudProvider: kubernetes
    manifestArtifactAccount: my-bitbucket-account
    manifestArtifactId: 38eefab0-78e4-4c9e-b779-4957de38e47b
    moniker:
      app: v2deploys
    relationships:
      loadBalancers: []
      securityGroups: []
    requiredArtifactIds: []
    source: artifact
    stageEnabled:
      expression: ${#stage("Automated Canary")["status"].toString() == "SUCCEEDED"}
      type: expression
  dependsOn:
  - acaTask10
  id: deployManifest19
  inheritanceControl: {}
  inject: {}
  name: Promote to Production
  type: deployManifest
- config:
    continuePipeline: false
    failPipeline: true
    job: bitbucket-restapp
    master: opsmx-jenkins-master
    parameters: {}
  id: jenkins20
  inheritanceControl: {}
  inject: {}
  name: Jenkins
  type: jenkins
- config:
    continuePipeline: false
    failPipeline: true
    job: Greeting Load
    master: opsmx-jenkins-master
    parameters:
      dnsip: 35.211.58.139
      port: "32285"
      port2: "32285"
  dependsOn:
  - deployManifest7
  - deployManifest8
  id: jenkins21
  inheritanceControl: {}
  inject: {}
  name: Load
  type: jenkins

